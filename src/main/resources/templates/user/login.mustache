<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>Login Page</title>
    <!--favicon.ico-->
    <link rel="icon" href="data:;base64,=">
</head>

<body>
<h1> Login Page </h1>
<hr />
<form>
    <!-- 이메일 입력 -->
    <input type="text" name="email" placeholder="email" id="user-email">
    <br />
    <!-- 비밀번호 입력 -->
    <input type="password" name="password" placeholder="password" id="user-password">
    <br />
    <button type="button" id="login-btn">로그인</button>
</form>
<a href="/signup-page">회원가입</a>

<Script>
    {
        // 로그인 버튼 변수화
        const LoginBtn = document.querySelector("#login-btn");

        // 로그인 클릭 이벤트 감지!
        LoginBtn.addEventListener("click", function () {
            // 사용자 객체 생성
            const user = {
                email: document.querySelector("#user-email").value,
                password: document.querySelector("#user-password").value
            };

            console.log(user);

            // fetch() - 비동기 통신을 위한 API
            const url = "/api/auth/login";
            fetch(url, {
                method: "post",
                body: JSON.stringify(user),
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
                if (response.ok) {
                    // 헤더에서 토큰 추출
                    const tokenHeader = response.headers.get("Authorization");
                    const token = tokenHeader ? tokenHeader.substring(6) : null;

                    // 토큰을 쿠키에 저장
                    setCookie("accessToken", token, 7);

                    alert("로그인 성공");
                    window.location.href = "/hi";
                } else {
                    response.json().then(errorData => {
                        alert(`로그인 실패: ${errorData.message}`);
                        throw new Error("로그인 실패");
                    });
                }
            }).catch(error => {
                console.error(error);
            });
        });

        function setCookie(name, value, days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        const expires = "expires=" + date.toUTCString();
        document.cookie = name + "=" + value + ";" + expires + ";path=/";
        }
    }
</script>
</body>

</html>