<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8" />
    <title>Login Page</title>
</head>

<body>
<h1> Login Page </h1>
<hr />
<form>
    <!-- 이메일 입력 -->
    <input type="text" name="email" placeholder="email" id="user-email">
    <br />
    <!-- 비밀번호 입력 -->
    <input type="password" name="password" placeholder="password" id="user-password">
    <br />
    <button type="button" id="login-btn">로그인</button>
</form>
<a href="/signup-page">회원가입</a>

<Script>
    {
        // 로그인 버튼 변수화
        const LoginBtn = document.querySelector("#login-btn");

        // 로그인 클릭 이벤트 감지!
        LoginBtn.addEventListener("click", function () {
            // 사용자 객체 생성
            const user = {
                email: document.querySelector("#user-email").value,
                password: document.querySelector("#user-password").value
            };

            console.log(user);

            // fetch() - 비동기 통신을 위한 API
            const url = "/api/auth/login";
            fetch(url, {
                method: "post",
                body: JSON.stringify(user),
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(response => {
                if (response.ok) {
                    return response.json(); // 로그인 성공 시 토큰을 받아옴
                } else {
                    response.json().then(errorData => {
                        alert(`로그인 실패: ${errorData.message}`);
                    });
                    throw new Error("로그인 실패");
                }
            }).then(data => {
                // 토큰을 localStorage 또는 쿠키에 저장
                localStorage.setItem("accessToken", data.accessToken);

                alert("로그인 성공");
                window.location.href = "/hi";
            }).catch(error => {
                console.error(error);
            });
        });
    }
</script>
</body>

</html>